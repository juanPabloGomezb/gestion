<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Auditor√≠a - FEMSA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #e31f26 0%, #1a237e 50%, #27ae60 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            flex-wrap: wrap;
        }

        .nav-tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #e31f26, #c0392b);
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #e31f26;
        }

        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #34495e;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #d68910);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-download {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            margin-right: 10px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        table th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            display: inline-block;
        }

        .status-cerrada {
            background: #d4edda;
            color: #155724;
        }

        .status-proceso {
            background: #fff3cd;
            color: #856404;
        }

        .status-abierta {
            background: #f8d7da;
            color: #721c24;
        }

        .status-mayor {
            background: #f8d7da;
            color: #721c24;
        }

        .status-menor {
            background: #fff3cd;
            color: #856404;
        }

        .status-observacion {
            background: #d1ecf1;
            color: #0c5460;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #27ae60, #229954);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #e31f26;
            display: block;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .upload-zone {
            border: 3px dashed #3498db;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .upload-zone:hover {
            background: #e3f2fd;
            border-color: #2980b9;
        }

        .upload-zone.dragover {
            background: #e3f2fd;
            border-color: #27ae60;
        }

        .file-list {
            list-style: none;
            margin-top: 20px;
        }

        .file-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 30px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -33px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3498db;
            border: 3px solid white;
            box-shadow: 0 0 0 3px #3498db;
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: -26px;
            top: 16px;
            width: 2px;
            height: calc(100% - 16px);
            background: #e0e0e0;
        }

        .timeline-item:last-child::after {
            display: none;
        }

        .timeline-item.completed::before {
            background: #27ae60;
            box-shadow: 0 0 0 3px #27ae60;
        }

        .timeline-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .timeline-date {
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            float: right;
            font-size: 2rem;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }

        .modal-close:hover {
            color: #e31f26;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 5px solid #17a2b8;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid #28a745;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 5px solid #ffc107;
        }

        .checklist {
            list-style: none;
        }

        .checklist-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checklist-item:hover {
            background: #e9ecef;
        }

        .checklist-item input[type="checkbox"] {
            width: 25px;
            height: 25px;
            margin-right: 15px;
            cursor: pointer;
        }

        .back-button {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç Sistema de Gesti√≥n de Auditor√≠as</h1>
        <p>ISO 9001:2015 | ISO 14001:2015 | ISO 45001:2018</p>
    </div>

    <div class="container">
        <a href="../index.html" class="back-button">‚¨Ö Volver al Portal SIG</a>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('plan')">üìã Plan de Auditor√≠a</button>
            <button class="nav-tab" onclick="showTab('anterior')">üìÅ Auditor√≠a Anterior</button>
            <button class="nav-tab" onclick="showTab('ejecucion')">üîÑ Ejecuci√≥n</button>
            <button class="nav-tab" onclick="showTab('hallazgos')">‚ö†Ô∏è Hallazgos</button>
            <button class="nav-tab" onclick="showTab('seguimiento')">üìä Seguimiento</button>
            <button class="nav-tab" onclick="showTab('reportes')">üìà Reportes</button>
        </div>

        <!-- TAB 1: PLAN DE AUDITOR√çA -->
        <div id="tab-plan" class="tab-content active">
            <h2 class="section-title">üìã Plan de Auditor√≠a Integral 2025</h2>

            <div class="alert alert-info">
                <strong>üìÖ Periodo de Auditor√≠a:</strong> Del 2 al 13 de diciembre de 2025 (10 d√≠as h√°biles)
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number">10</span>
                    <span class="stat-label">D√≠as de Auditor√≠a</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">4</span>
                    <span class="stat-label">Auditores</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">15</span>
                    <span class="stat-label">Procesos a Auditar</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">3</span>
                    <span class="stat-label">Normas ISO</span>
                </div>
            </div>

            <div class="card">
                <h3>üì• Descargar Documentaci√≥n</h3>
                <p style="margin-bottom: 20px;">Descarga el plan de auditor√≠a completo y otros documentos esenciales:</p>
                <button class="btn btn-download" onclick="downloadPlan()">üìÑ Plan de Auditor√≠a Completo</button>
                <button class="btn btn-primary" onclick="alert('Documento en desarrollo')">üìã Lista de Verificaci√≥n</button>
                <button class="btn btn-success" onclick="alert('Documento en desarrollo')">üìä Plantilla de Hallazgos</button>
            </div>

            <div class="card">
                <h3>üìÖ Cronograma de Auditor√≠a</h3>
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date">D√≠a 1 - 02/12/2025</div>
                            <strong>Reuni√≥n de Apertura</strong>
                            <p>Presentaci√≥n del equipo, revisi√≥n del plan y auditor√≠a de planificaci√≥n estrat√©gica</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date">D√≠as 2-3 - 03-04/12/2025</div>
                            <strong>Procesos Operativos</strong>
                            <p>Auditor√≠a de producci√≥n, control de calidad y gesti√≥n ambiental</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date">D√≠as 4-5 - 05-06/12/2025</div>
                            <strong>Seguridad y Salud en el Trabajo</strong>
                            <p>Investigaci√≥n de incidentes e inspecciones SST</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date">D√≠as 6-7 - 09-10/12/2025</div>
                            <strong>Log√≠stica y Distribuci√≥n</strong>
                            <p>Centro de distribuci√≥n Bogot√° y gesti√≥n de flotas</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date">D√≠a 8 - 11/12/2025</div>
                            <strong>Procesos de Apoyo</strong>
                            <p>RRHH, mantenimiento, compras y control documental</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date">D√≠a 9 - 12/12/2025</div>
                            <strong>An√°lisis de Hallazgos</strong>
                            <p>Consolidaci√≥n de evidencias y preparaci√≥n de informe</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date">D√≠a 10 - 13/12/2025</div>
                            <strong>Reuni√≥n de Cierre</strong>
                            <p>Presentaci√≥n de hallazgos y entrega de informe preliminar</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: AUDITOR√çA ANTERIOR -->
        <div id="tab-anterior" class="tab-content">
            <h2 class="section-title">üìÅ Revisi√≥n de Auditor√≠a Anterior</h2>

            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Importante:</strong> Cargar los resultados de la auditor√≠a anterior (Junio 2025) para verificar el cierre de no conformidades y evaluar la eficacia de las acciones correctivas.
            </div>

            <div class="card">
                <h3>üì§ Cargar Documentos de Auditor√≠a Anterior</h3>
                <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
                    <p style="font-size: 3rem; margin-bottom: 10px;">üìÅ</p>
                    <p style="font-size: 1.2rem; font-weight: bold; margin-bottom: 10px;">Arrastra archivos aqu√≠ o haz clic para seleccionar</p>
                    <p style="color: #7f8c8d;">Formatos aceptados: PDF, DOCX, XLSX</p>
                    <input type="file" id="fileInput" multiple accept=".pdf,.docx,.xlsx" style="display: none;" onchange="handleFiles(this.files)">
                </div>
                <ul class="file-list" id="fileList"></ul>
            </div>

            <div class="card">
                <h3>üìä Estado de No Conformidades de Auditor√≠a Anterior</h3>
                <button class="btn btn-primary" onclick="showModal('addNCModal')" style="margin-bottom: 20px;">‚ûï Agregar NC Anterior</button>
                
                <div class="table-container">
                    <table id="ncAnteriorTable">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Descripci√≥n</th>
                                <th>Tipo</th>
                                <th>Proceso</th>
                                <th>Estado</th>
                                <th>Fecha Cierre</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>NC-001-2025</td>
                                <td>Falta de actualizaci√≥n de matriz de riesgos</td>
                                <td><span class="status-badge status-mayor">NC Mayor</span></td>
                                <td>Gesti√≥n de Riesgos</td>
                                <td><span class="status-badge status-cerrada">CERRADA</span></td>
                                <td>15/08/2025</td>
                                <td><button class="btn btn-primary" onclick="verDetalle('NC-001-2025')">Ver</button></td>
                            </tr>
                            <tr>
                                <td>NC-002-2025</td>
                                <td>Registros de calibraci√≥n incompletos</td>
                                <td><span class="status-badge status-menor">NC Menor</span></td>
                                <td>Mantenimiento</td>
                                <td><span class="status-badge status-proceso">EN PROCESO</span></td>
                                <td>30/11/2025</td>
                                <td><button class="btn btn-primary" onclick="verDetalle('NC-002-2025')">Ver</button></td>
                            </tr>
                            <tr>
                                <td>NC-003-2025</td>
                                <td>Plan de capacitaci√≥n sin evidencias de ejecuci√≥n</td>
                                <td><span class="status-badge status-menor">NC Menor</span></td>
                                <td>RRHH</td>
                                <td><span class="status-badge status-abierta">ABIERTA</span></td>
                                <td>-</td>
                                <td><button class="btn btn-primary" onclick="verDetalle('NC-003-2025')">Ver</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>üìà Estad√≠sticas de Seguimiento</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number">8</span>
                        <span class="stat-label">Total NC Anteriores</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" style="color: #27ae60;">5</span>
                        <span class="stat-label">NC Cerradas</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" style="color: #f39c12;">2</span>
                        <span class="stat-label">NC En Proceso</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" style="color: #e74c3c;">1</span>
                        <span class="stat-label">NC Abiertas</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 62.5%;">62.5% Cerradas</div>
                </div>
            </div>
        </div>

        <!-- TAB 3: EJECUCI√ìN -->
        <div id="tab-ejecucion" class="tab-content">
            <h2 class="section-title">üîÑ Ejecuci√≥n de la Auditor√≠a</h2>

            <div class="card">
                <h3>‚úÖ Lista de Verificaci√≥n de Procesos</h3>
                <p style="margin-bottom: 20px;">Marca los procesos conforme se van auditando:</p>
                
                <h4 style="color: #e74c3c; margin-top: 20px;">Procesos Estrat√©gicos</h4>
                <ul class="checklist">
                    <li class="checklist-item">
                        <input type="checkbox" id="proc1" onchange="updateProgress()">
                        <label for="proc1">Planificaci√≥n Estrat√©gica - Contexto y Partes Interesadas</label>
                    </li>
                    <li class="checklist-item">
                        <input type="checkbox" id="proc2" onchange="updateProgress()">
                        <label for="proc2">Gesti√≥n de Riesgos y Oportunidades</label>
                    </li>
                    <li class="checklist-item">
                        <input type="checkbox" id="proc3" onchange="updateProgress()">
                        <label for="proc3">Revisi√≥n por la Direcci√≥n</label>
                    </li>
                </ul>

                <h4 style="color: #3498db; margin-top: 20px;">Procesos Operativos</h4>
                <ul class="checklist">
                    <li class="checklist-item">
                        <input type="checkbox" id="proc4" onchange="updateProgress()">
                        <label for="proc4">Producci√≥n - Control de Procesos</label>
                    </li>
                    <li class="checklist-item">
                        <input type="checkbox" id="proc5" onchange="updateProgress()">
                        <label for="proc5">Control de Calidad - No Conformidades</label>
                    </li>
                    <li class="checklist-item">
                        <input type="checkbox" id="proc6" onchange="updateProgress()">
                        <label for="proc6">Log√≠stica y Distribuci√≥n</label>
                    </li>
                    <li class="checklist-item">
                        <input type="checkbox" id="proc7" onchange="updateProgress()">
                        <label for="proc7">Gesti√≥n Ambiental - Aspectos e Impactos</label>
                    </li>
                    <li class="checklist-item">
                        <input type="checkbox" id="proc8" onchange="updateProgress()">
                        <label for="proc8">Seguridad y Salud en el Trabajo</label>
                    </li>
                </ul>

                <h4 style="color: #27ae60; margin-top: 20px;">Procesos de Apoyo</h4>
                <ul class="checklist">
                    <li class="checklist-item">
                        <input type="checkbox" id="proc9" onchange="updateProgress()">
                        <label for="proc9">Recursos Humanos - Competencias</label>
                    </li>
                    <li class="checklist-item">
                        <input type="checkbox" id="proc10" onchange="updateProgress()">
                        <label for="proc10">Mantenimiento y Calibraci√≥n</label>
                    </li>
                    <li class="checklist-item">
                        <input type="checkbox" id="proc11" onchange="updateProgress()">
                        <label for="proc11">Compras y Evaluaci√≥n de Proveedores</label>
                    </li>
                    <li class="checklist-item">
                        <input type="checkbox" id="proc12" onchange="updateProgress()">
                        <label for="proc12">Control Documental</label>
                    </li>
                </ul>

                <div style="margin-top: 30px;">
                    <h4>Progreso General de Auditor√≠a</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 0%;">0%</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üìù Registro Diario de Actividades</h3>
                <div class="form-group">
                    <label>Fecha</label>
                    <input type="date" id="actividadFecha">
                </div>
                <div class="form-group">
                    <label>Proceso Auditado</label>
                    <select id="actividadProceso">
                        <option>Seleccionar proceso...</option>
                        <option>Planificaci√≥n Estrat√©gica</option>
                        <option>Gesti√≥n de Riesgos</option>
                        <option>Producci√≥n</option>
                        <option>Control de Calidad</option>
                        <option>Gesti√≥n Ambiental</option>
                        <option>SST</option>
                        <option>Log√≠stica</option>
                        <option>RRHH</option>
                        <option>Mantenimiento</option>
                        <option>Compras</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Auditor Responsable</label>
                    <select id="actividadAuditor">
                        <option>Seleccionar auditor...</option>
                        <option>Ing. Mar√≠a Fern√°ndez (L√≠der)</option>
                        <option>Ing. Carlos M√©ndez (Calidad)</option>
                        <option>Ing. Laura G√≥mez (Ambiental)</option>
                        <option>Ing. Roberto Silva (SST)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Actividades Realizadas</label>
                    <textarea id="actividadDescripcion" placeholder="Describir actividades del d√≠a, entrevistas, revisiones documentales, inspecciones..."></textarea>
                </div>
                <div class="form-group">
                    <label>Observaciones</label>
                    <textarea id="actividadObservaciones" placeholder="Observaciones preliminares o puntos de atenci√≥n..."></textarea>
                </div>
                <button class="btn btn-success" onclick="guardarActividad()">üíæ Guardar Actividad</button>
            </div>
        </div>

        <!-- TAB 4: HALLAZGOS -->
        <div id="tab-hallazgos" class="tab-content">
            <h2 class="section-title">‚ö†Ô∏è Registro de Hallazgos</h2>

            <div class="card">
                <h3>‚ûï Registrar Nuevo Hallazgo</h3>
                <div class="form-group">
                    <label>Tipo de Hallazgo</label>
                    <select id="tipoHallazgo">
                        <option>Seleccionar tipo...</option>
                        <option value="mayor">No Conformidad Mayor</option>
                        <option value="menor">No Conformidad Menor</option>
                        <option value="observacion">Observaci√≥n</option>
                        <option value="oportunidad">Oportunidad de Mejora</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Norma Aplicable</label>
                    <select id="normaHallazgo">
                        <option>Seleccionar norma...</option>
                        <option>ISO 9001:2015 (Calidad)</option>
                        <option>ISO 14001:2015 (Ambiental)</option>
                        <option>ISO 45001:2018 (SST)</option>
                        <option>Integrado (M√∫ltiples normas)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Proceso Afectado</label>
                    <select id="procesoHallazgo">
                        <option>Seleccionar proceso...</option>
                        <option>Planificaci√≥n Estrat√©gica</option>
                        <option>Gesti√≥n de Riesgos</option>
                        <option>Producci√≥n</option>
                        <option>Control de Calidad</option>
                        <option>Gesti√≥n Ambiental</option>
                        <option>SST</option>
                        <option>Log√≠stica y Distribuci√≥n</option>
                        <option>RRHH</option>
                        <option>Mantenimiento</option>
                        <option>Compras</option>
                        <option>Control Documental</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Requisito No Cumplido</label>
                    <input type="text" id="requisitoHallazgo" placeholder="Ej: 8.5.1 - Control de la producci√≥n y de la provisi√≥n del servicio">
                </div>
                <div class="form-group">
                    <label>Descripci√≥n del Hallazgo</label>
                    <textarea id="descripcionHallazgo" placeholder="Describir el hallazgo de manera clara y objetiva, incluyendo evidencias..."></textarea>
                </div>
                <div class="form-group">
                    <label>Evidencias (Documentos, fotos, registros)</label>
                    <textarea id="evidenciasHallazgo" placeholder="Listar evidencias objetivas que soportan el hallazgo..."></textarea>
                </div>
                <div class="form-group">
                    <label>Causa Ra√≠z Identificada</label>
                    <textarea id="causaHallazgo" placeholder="An√°lisis de la causa ra√≠z del hallazgo..."></textarea>
                </div>
                <div class="form-group">
                    <label>Auditor que Identifica</label>
                    <select id="auditorHallazgo">
                        <option>Seleccionar auditor...</option>
                        <option>Ing. Mar√≠a Fern√°ndez (L√≠der)</option>
                        <option>Ing. Carlos M√©ndez (Calidad)</option>
                        <option>Ing. Laura G√≥mez (Ambiental)</option>
                        <option>Ing. Roberto Silva (SST)</option>
                    </select>
                </div>
                <button class="btn btn-danger" onclick="registrarHallazgo()">üìù Registrar Hallazgo</button>
            </div>

            <div class="card">
                <h3>üìã Hallazgos Registrados</h3>
                <div class="stats-grid" style="margin-bottom: 20px;">
                    <div class="stat-card">
                        <span class="stat-number" id="totalHallazgos">0</span>
                        <span class="stat-label">Total Hallazgos</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" style="color: #e74c3c;" id="totalMayores">0</span>
                        <span class="stat-label">NC Mayores</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" style="color: #f39c12;" id="totalMenores">0</span>
                        <span class="stat-label">NC Menores</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" style="color: #3498db;" id="totalObservaciones">0</span>
                        <span class="stat-label">Observaciones</span>
                    </div>
                </div>

                <div class="table-container">
                    <table id="hallazgosTable">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Tipo</th>
                                <th>Proceso</th>
                                <th>Norma</th>
                                <th>Descripci√≥n</th>
                                <th>Auditor</th>
                                <th>Fecha</th>
                            </tr>
                        </thead>
                        <tbody id="hallazgosTableBody">
                            <!-- Los hallazgos se agregar√°n din√°micamente aqu√≠ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB 5: SEGUIMIENTO -->
        <div id="tab-seguimiento" class="tab-content">
            <h2 class="section-title">üìä Seguimiento de Acciones Correctivas</h2>

            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è Informaci√≥n:</strong> Esta secci√≥n permite hacer seguimiento a las acciones correctivas derivadas de los hallazgos identificados en la auditor√≠a actual.
            </div>

            <div class="card">
                <h3>üéØ Plan de Acci√≥n para Hallazgos</h3>
                <div class="form-group">
                    <label>Seleccionar Hallazgo</label>
                    <select id="hallazgoSeguimiento">
                        <option>Seleccionar hallazgo...</option>
                        <!-- Se llenar√° din√°micamente con los hallazgos registrados -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Acci√≥n Correctiva Propuesta</label>
                    <textarea id="accionCorrectiva" placeholder="Describir la acci√≥n correctiva a implementar..."></textarea>
                </div>
                <div class="form-group">
                    <label>Responsable de Implementaci√≥n</label>
                    <input type="text" id="responsableAccion" placeholder="Nombre y cargo del responsable">
                </div>
                <div class="form-group">
                    <label>Fecha Compromiso de Cierre</label>
                    <input type="date" id="fechaCierre">
                </div>
                <div class="form-group">
                    <label>Recursos Necesarios</label>
                    <textarea id="recursosAccion" placeholder="Presupuesto, personal, equipos, capacitaci√≥n..."></textarea>
                </div>
                <button class="btn btn-success" onclick="guardarAccion()">üíæ Guardar Plan de Acci√≥n</button>
            </div>

            <div class="card">
                <h3>üìà Estado de Implementaci√≥n</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Hallazgo</th>
                                <th>Acci√≥n Correctiva</th>
                                <th>Responsable</th>
                                <th>Fecha Compromiso</th>
                                <th>Estado</th>
                                <th>% Avance</th>
                            </tr>
                        </thead>
                        <tbody id="seguimientoTableBody">
                            <!-- Se llenar√° din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB 6: REPORTES -->
        <div id="tab-reportes" class="tab-content">
            <h2 class="section-title">üìà Reportes y An√°lisis</h2>

            <div class="card">
                <h3>üìä Resumen Ejecutivo de Auditor√≠a</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number" id="reporteProgreso">0%</span>
                        <span class="stat-label">Progreso de Auditor√≠a</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="reporteProcesos">0/12</span>
                        <span class="stat-label">Procesos Auditados</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="reporteHallazgos">0</span>
                        <span class="stat-label">Total Hallazgos</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="reporteConformidad">0%</span>
                        <span class="stat-label">Nivel de Conformidad</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üìÑ Generar Informes</h3>
                <p style="margin-bottom: 20px;">Selecciona el tipo de informe que deseas generar:</p>
                <button class="btn btn-primary" onclick="generarInforme('preliminar')">üìã Informe Preliminar</button>
                <button class="btn btn-success" onclick="generarInforme('final')">üìÑ Informe Final</button>
                <button class="btn btn-warning" onclick="generarInforme('hallazgos')">‚ö†Ô∏è Reporte de Hallazgos</button>
                <button class="btn btn-download" onclick="generarInforme('ejecutivo')">üìä Resumen Ejecutivo</button>
            </div>

            <div class="card">
                <h3>üìä An√°lisis por Norma</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Norma</th>
                                <th>Procesos Auditados</th>
                                <th>NC Mayores</th>
                                <th>NC Menores</th>
                                <th>Observaciones</th>
                                <th>% Conformidad</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>ISO 9001:2015</strong></td>
                                <td>8/8</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td><span class="status-badge status-cerrada">100%</span></td>
                            </tr>
                            <tr>
                                <td><strong>ISO 14001:2015</strong></td>
                                <td>6/6</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td><span class="status-badge status-cerrada">100%</span></td>
                            </tr>
                            <tr>
                                <td><strong>ISO 45001:2018</strong></td>
                                <td>5/5</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td><span class="status-badge status-cerrada">100%</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>üéØ Conclusiones y Recomendaciones</h3>
                <div class="form-group">
                    <label>Conclusiones Generales de la Auditor√≠a</label>
                    <textarea id="conclusiones" placeholder="Describir las conclusiones principales..."></textarea>
                </div>
                <div class="form-group">
                    <label>Fortalezas Identificadas</label>
                    <textarea id="fortalezas" placeholder="Listar las fortalezas del SIG..."></textarea>
                </div>
                <div class="form-group">
                    <label>√Åreas de Mejora</label>
                    <textarea id="mejoras" placeholder="Identificar √°reas de oportunidad..."></textarea>
                </div>
                <div class="form-group">
                    <label>Recomendaciones</label>
                    <textarea id="recomendaciones" placeholder="Recomendaciones para la alta direcci√≥n..."></textarea>
                </div>
                <button class="btn btn-success" onclick="guardarConclusiones()">üíæ Guardar Conclusiones</button>
            </div>
        </div>
    </div>

    <!-- MODAL PARA AGREGAR NC ANTERIOR -->
    <div id="addNCModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('addNCModal')">&times;</span>
            <h2>Agregar No Conformidad de Auditor√≠a Anterior</h2>
            <div class="form-group">
                <label>C√≥digo NC</label>
                <input type="text" id="modalCodigo" placeholder="NC-XXX-2025">
            </div>
            <div class="form-group">
                <label>Descripci√≥n</label>
                <textarea id="modalDescripcion"></textarea>
            </div>
            <div class="form-group">
                <label>Tipo</label>
                <select id="modalTipo">
                    <option value="mayor">NC Mayor</option>
                    <option value="menor">NC Menor</option>
                </select>
            </div>
            <div class="form-group">
                <label>Proceso</label>
                <input type="text" id="modalProceso">
            </div>
            <div class="form-group">
                <label>Estado</label>
                <select id="modalEstado">
                    <option value="cerrada">CERRADA</option>
                    <option value="proceso">EN PROCESO</option>
                    <option value="abierta">ABIERTA</option>
                </select>
            </div>
            <button class="btn btn-success" onclick="agregarNCAnterior()">Agregar</button>
        </div>
    </div>

    <script>
        // Variables globales
        let hallazgos = [];
        let actividades = [];
        let accionesCorrectivas = [];

        // Funci√≥n para cambiar de tab
        function showTab(tabName) {
            // Ocultar todos los tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remover clase active de todos los botones
            const buttons = document.querySelectorAll('.nav-tab');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Mostrar el tab seleccionado
            document.getElementById('tab-' + tabName).classList.add('active');
            
            // Marcar el bot√≥n activo
            event.target.classList.add('active');
        }

        // Funci√≥n para descargar el plan de auditor√≠a
        function downloadPlan() {
            window.location.href = '/mnt/user-data/outputs/Plan_Auditoria_Integral_FEMSA.docx';
        }

        // Drag and drop para archivos
        const uploadZone = document.getElementById('uploadZone');
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        function handleFiles(files) {
            const fileList = document.getElementById('fileList');
            Array.from(files).forEach(file => {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.innerHTML = `
                    <span>üìÑ ${file.name} (${(file.size / 1024).toFixed(2)} KB)</span>
                    <button class="btn btn-danger" style="padding: 5px 15px;" onclick="this.parentElement.remove()">Eliminar</button>
                `;
                fileList.appendChild(li);
            });
        }

        // Actualizar progreso de auditor√≠a
        function updateProgress() {
            const checkboxes = document.querySelectorAll('.checklist input[type="checkbox"]');
            const checked = document.querySelectorAll('.checklist input[type="checkbox"]:checked').length;
            const total = checkboxes.length;
            const percentage = Math.round((checked / total) * 100);
            
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage + '%';

            // Actualizar en reportes
            document.getElementById('reporteProgreso').textContent = percentage + '%';
            document.getElementById('reporteProcesos').textContent = checked + '/' + total;
        }

        // Guardar actividad diaria
        function guardarActividad() {
            const fecha = document.getElementById('actividadFecha').value;
            const proceso = document.getElementById('actividadProceso').value;
            const auditor = document.getElementById('actividadAuditor').value;
            const descripcion = document.getElementById('actividadDescripcion').value;
            const observaciones = document.getElementById('actividadObservaciones').value;

            if (!fecha || proceso === 'Seleccionar proceso...' || !auditor || !descripcion) {
                alert('Por favor complete todos los campos requeridos');
                return;
            }

            const actividad = {
                fecha,
                proceso,
                auditor,
                descripcion,
                observaciones,
                timestamp: new Date().toISOString()
            };

            actividades.push(actividad);
            
            alert('‚úÖ Actividad guardada exitosamente');
            
            // Limpiar formulario
            document.getElementById('actividadFecha').value = '';
            document.getElementById('actividadProceso').selectedIndex = 0;
            document.getElementById('actividadAuditor').selectedIndex = 0;
            document.getElementById('actividadDescripcion').value = '';
            document.getElementById('actividadObservaciones').value = '';
        }

        // Registrar hallazgo
        function registrarHallazgo() {
            const tipo = document.getElementById('tipoHallazgo').value;
            const norma = document.getElementById('normaHallazgo').value;
            const proceso = document.getElementById('procesoHallazgo').value;
            const requisito = document.getElementById('requisitoHallazgo').value;
            const descripcion = document.getElementById('descripcionHallazgo').value;
            const evidencias = document.getElementById('evidenciasHallazgo').value;
            const causa = document.getElementById('causaHallazgo').value;
            const auditor = document.getElementById('auditorHallazgo').value;

            if (tipo === 'Seleccionar tipo...' || !norma || !proceso || !requisito || !descripcion) {
                alert('Por favor complete todos los campos requeridos');
                return;
            }

            const codigo = `H-${String(hallazgos.length + 1).padStart(3, '0')}-2025`;
            const fecha = new Date().toLocaleDateString('es-CO');

            const hallazgo = {
                codigo,
                tipo,
                norma,
                proceso,
                requisito,
                descripcion,
                evidencias,
                causa,
                auditor,
                fecha,
                timestamp: new Date().toISOString()
            };

            hallazgos.push(hallazgo);

            // Actualizar tabla
            actualizarTablaHallazgos();

            // Actualizar estad√≠sticas
            actualizarEstadisticasHallazgos();

            alert('‚úÖ Hallazgo registrado exitosamente con c√≥digo: ' + codigo);

            // Limpiar formulario
            document.getElementById('tipoHallazgo').selectedIndex = 0;
            document.getElementById('normaHallazgo').selectedIndex = 0;
            document.getElementById('procesoHallazgo').selectedIndex = 0;
            document.getElementById('requisitoHallazgo').value = '';
            document.getElementById('descripcionHallazgo').value = '';
            document.getElementById('evidenciasHallazgo').value = '';
            document.getElementById('causaHallazgo').value = '';
            document.getElementById('auditorHallazgo').selectedIndex = 0;
        }

        function actualizarTablaHallazgos() {
            const tbody = document.getElementById('hallazgosTableBody');
            tbody.innerHTML = '';

            hallazgos.forEach(h => {
                const tr = document.createElement('tr');
                let tipoBadge = '';
                if (h.tipo === 'mayor') tipoBadge = '<span class="status-badge status-mayor">NC Mayor</span>';
                else if (h.tipo === 'menor') tipoBadge = '<span class="status-badge status-menor">NC Menor</span>';
                else if (h.tipo === 'observacion') tipoBadge = '<span class="status-badge status-observacion">Observaci√≥n</span>';
                else tipoBadge = '<span class="status-badge status-cerrada">Oportunidad</span>';

                tr.innerHTML = `
                    <td>${h.codigo}</td>
                    <td>${tipoBadge}</td>
                    <td>${h.proceso}</td>
                    <td>${h.norma}</td>
                    <td style="max-width: 300px;">${h.descripcion.substring(0, 100)}...</td>
                    <td>${h.auditor}</td>
                    <td>${h.fecha}</td>
                `;
                tbody.appendChild(tr);
            });

            // Actualizar select de seguimiento
            const select = document.getElementById('hallazgoSeguimiento');
            select.innerHTML = '<option>Seleccionar hallazgo...</option>';
            hallazgos.forEach(h => {
                const option = document.createElement('option');
                option.value = h.codigo;
                option.textContent = `${h.codigo} - ${h.proceso}`;
                select.appendChild(option);
            });
        }

        function actualizarEstadisticasHallazgos() {
            const total = hallazgos.length;
            const mayores = hallazgos.filter(h => h.tipo === 'mayor').length;
            const menores = hallazgos.filter(h => h.tipo === 'menor').length;
            const observaciones = hallazgos.filter(h => h.tipo === 'observacion').length;

            document.getElementById('totalHallazgos').textContent = total;
            document.getElementById('totalMayores').textContent = mayores;
            document.getElementById('totalMenores').textContent = menores;
            document.getElementById('totalObservaciones').textContent = observaciones;

            // Actualizar en reportes
            document.getElementById('reporteHallazgos').textContent = total;
            
            // Calcular conformidad
            const procesosAuditados = document.querySelectorAll('.checklist input[type="checkbox"]:checked').length;
            const conformidad = procesosAuditados > 0 ? Math.round(((procesosAuditados - mayores - menores) / procesosAuditados) * 100) : 100;
            document.getElementById('reporteConformidad').textContent = conformidad + '%';
        }

        // Guardar acci√≥n correctiva
        function guardarAccion() {
            const hallazgo = document.getElementById('hallazgoSeguimiento').value;
            const accion = document.getElementById('accionCorrectiva').value;
            const responsable = document.getElementById('responsableAccion').value;
            const fecha = document.getElementById('fechaCierre').value;
            const recursos = document.getElementById('recursosAccion').value;

            if (hallazgo === 'Seleccionar hallazgo...' || !accion || !responsable || !fecha) {
                alert('Por favor complete todos los campos requeridos');
                return;
            }

            const accionCorrectiva = {
                hallazgo,
                accion,
                responsable,
                fecha,
                recursos,
                estado: 'Planificada',
                avance: 0
            };

            accionesCorrectivas.push(accionCorrectiva);

            alert('‚úÖ Plan de acci√≥n guardado exitosamente');

            // Limpiar formulario
            document.getElementById('hallazgoSeguimiento').selectedIndex = 0;
            document.getElementById('accionCorrectiva').value = '';
            document.getElementById('responsableAccion').value = '';
            document.getElementById('fechaCierre').value = '';
            document.getElementById('recursosAccion').value = '';

            // Actualizar tabla de seguimiento
            actualizarTablaSeguimiento();
        }

        function actualizarTablaSeguimiento() {
            const tbody = document.getElementById('seguimientoTableBody');
            tbody.innerHTML = '';

            accionesCorrectivas.forEach(ac => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${ac.hallazgo}</td>
                    <td style="max-width: 300px;">${ac.accion}</td>
                    <td>${ac.responsable}</td>
                    <td>${ac.fecha}</td>
                    <td><span class="status-badge status-proceso">${ac.estado}</span></td>
                    <td>
                        <div class="progress-bar" style="height: 20px;">
                            <div class="progress-fill" style="width: ${ac.avance}%; font-size: 0.8rem;">${ac.avance}%</div>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Generar informes
        function generarInforme(tipo) {
            let mensaje = '';
            switch(tipo) {
                case 'preliminar':
                    mensaje = 'üìã Generando Informe Preliminar...\n\nEste informe incluye los hallazgos identificados hasta el momento.';
                    break;
                case 'final':
                    mensaje = 'üìÑ Generando Informe Final...\n\nEste es el informe completo de la auditor√≠a con todas las conclusiones.';
                    break;
                case 'hallazgos':
                    mensaje = '‚ö†Ô∏è Generando Reporte de Hallazgos...\n\nTotal de hallazgos: ' + hallazgos.length;
                    break;
                case 'ejecutivo':
                    mensaje = 'üìä Generando Resumen Ejecutivo...\n\nDocumento de alto nivel para la direcci√≥n.';
                    break;
            }
            alert(mensaje);
        }

        // Guardar conclusiones
        function guardarConclusiones() {
            const conclusiones = document.getElementById('conclusiones').value;
            const fortalezas = document.getElementById('fortalezas').value;
            const mejoras = document.getElementById('mejoras').value;
            const recomendaciones = document.getElementById('recomendaciones').value;

            if (!conclusiones || !fortalezas || !mejoras || !recomendaciones) {
                alert('Por favor complete todos los campos');
                return;
            }

            alert('‚úÖ Conclusiones guardadas exitosamente');
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function agregarNCAnterior() {
            const codigo = document.getElementById('modalCodigo').value;
            const descripcion = document.getElementById('modalDescripcion').value;
            const tipo = document.getElementById('modalTipo').value;
            const proceso = document.getElementById('modalProceso').value;
            const estado = document.getElementById('modalEstado').value;

            if (!codigo || !descripcion || !proceso) {
                alert('Complete todos los campos');
                return;
            }

            // Aqu√≠ se agregar√≠a a la tabla
            alert('NC agregada exitosamente');
            closeModal('addNCModal');
        }

        function verDetalle(codigo) {
            alert('Mostrando detalles de: ' + codigo);
        }

        // Cerrar modal al hacer click fuera
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>